import{_ as s,c as a,o as i,aj as n}from"./chunks/framework.CSCBGoZg.js";const k=JSON.parse('{"title":"Workspace Management","description":"","frontmatter":{},"headers":[],"relativePath":"specs/WORKSPACE.md","filePath":"specs/WORKSPACE.md"}'),t={name:"specs/WORKSPACE.md"};function l(o,e,r,p,c,d){return i(),a("div",null,[...e[0]||(e[0]=[n(`<h1 id="workspace-management" tabindex="-1">Workspace Management <a class="header-anchor" href="#workspace-management" aria-label="Permalink to “Workspace Management”">​</a></h1><p><strong>Version:</strong> 0.1.0 <strong>Last Updated:</strong> November 2025</p><p>This document describes the workspace mechanism in Vex, designed to facilitate the management of multiple related packages within a single repository (monorepo) or for local development of interdependent packages.</p><hr><h2 id="table-of-contents" tabindex="-1">Table of Contents <a class="header-anchor" href="#table-of-contents" aria-label="Permalink to “Table of Contents”">​</a></h2><ol><li><a href="#overview">Overview</a></li><li><a href="#workspace-configuration-vexworkspace">Workspace Configuration (vex.workspace)</a></li><li><a href="#directory-structure">Directory Structure</a></li><li><a href="#dependency-resolution">Dependency Resolution</a></li><li><a href="#build-artifacts">Build Artifacts</a></li><li><a href="#cli-behavior">CLI Behavior</a></li></ol><hr><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to “Overview”">​</a></h2><p>A <strong>Workspace</strong> is a collection of one or more Vex packages that share:</p><ol><li><strong>Dependency Resolution</strong>: A single <code>vex.lock</code> file at the workspace root ensures all packages use compatible versions of shared dependencies.</li><li><strong>Build Directory</strong>: A shared <code>vex-builds</code> directory to avoid redundant compilations and save disk space.</li><li><strong>Configuration</strong>: Shared profiles and compiler settings.</li></ol><p>This system is inspired by Rust&#39;s Cargo Workspaces and Go&#39;s Multi-Module Workspaces.</p><h3 id="key-benefits" tabindex="-1">Key Benefits <a class="header-anchor" href="#key-benefits" aria-label="Permalink to “Key Benefits”">​</a></h3><ul><li><strong>Monorepo Support</strong>: Easily manage large projects split into multiple libraries and binaries.</li><li><strong>Local Development</strong>: Simultaneously develop a library and an application that uses it without publishing intermediate versions.</li><li><strong>Unified Tooling</strong>: Run tests across all packages with a single command.</li></ul><hr><h2 id="workspace-configuration-vex-workspace" tabindex="-1">Workspace Configuration (vex.workspace) <a class="header-anchor" href="#workspace-configuration-vex-workspace" aria-label="Permalink to “Workspace Configuration (vex.workspace)”">​</a></h2><p>A workspace is defined by a <code>vex.workspace</code> file at the root of the directory structure. This file is in JSON format, consistent with <code>vex.json</code>.</p><h3 id="file-format" tabindex="-1">File Format <a class="header-anchor" href="#file-format" aria-label="Permalink to “File Format”">​</a></h3><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;workspace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;members&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;cli&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tools/*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;exclude&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;tools/experimental&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;default-members&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;cli&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;profiles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;development&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;optimizationLevel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;release&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;optimizationLevel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;lto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="fields" tabindex="-1">Fields <a class="header-anchor" href="#fields" aria-label="Permalink to “Fields”">​</a></h3><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>members</code></td><td>array</td><td>List of directories or glob patterns containing <code>vex.json</code> files.</td></tr><tr><td><code>exclude</code></td><td>array</td><td>List of directories or glob patterns to exclude from the workspace.</td></tr><tr><td><code>default-members</code></td><td>array</td><td>Packages to build/test by default if none are specified.</td></tr><tr><td><code>profiles</code></td><td>object</td><td>Shared build profiles (overrides package-level profiles).</td></tr></tbody></table><hr><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to “Directory Structure”">​</a></h2><p>A typical workspace layout looks like this:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>my-monorepo/</span></span>
<span class="line"><span>├── vex.workspace       # Workspace definition</span></span>
<span class="line"><span>├── vex.lock            # Unified lock file</span></span>
<span class="line"><span>├── vex-builds/         # Shared build artifacts</span></span>
<span class="line"><span>├── core/</span></span>
<span class="line"><span>│   ├── vex.json        # Package manifest (name: &quot;my-core&quot;)</span></span>
<span class="line"><span>│   └── src/</span></span>
<span class="line"><span>├── net/</span></span>
<span class="line"><span>│   ├── vex.json        # Package manifest (name: &quot;my-net&quot;)</span></span>
<span class="line"><span>│   └── src/</span></span>
<span class="line"><span>└── cli/</span></span>
<span class="line"><span>    ├── vex.json        # Package manifest (name: &quot;my-cli&quot;)</span></span>
<span class="line"><span>    └── src/</span></span></code></pre></div><p>In this example:</p><ul><li><code>my-cli</code> can depend on <code>my-core</code> and <code>my-net</code>.</li><li>Since they are in the same workspace, Vex will resolve these dependencies to the local paths automatically, ignoring version requirements in <code>vex.json</code> that might point to a registry, provided the local version is compatible.</li></ul><hr><h2 id="dependency-resolution" tabindex="-1">Dependency Resolution <a class="header-anchor" href="#dependency-resolution" aria-label="Permalink to “Dependency Resolution”">​</a></h2><h3 id="single-lock-file" tabindex="-1">Single Lock File <a class="header-anchor" href="#single-lock-file" aria-label="Permalink to “Single Lock File”">​</a></h3><p>The workspace maintains a single <code>vex.lock</code> file at the workspace root. This ensures that if <code>core</code> and <code>net</code> both depend on <code>external-lib</code>, they both use the exact same version of <code>external-lib</code>.</p><h3 id="local-path-overrides" tabindex="-1">Local Path Overrides <a class="header-anchor" href="#local-path-overrides" aria-label="Permalink to “Local Path Overrides”">​</a></h3><p>Within a workspace, dependencies between member packages are resolved to their local directory paths.</p><p><strong>Example:</strong></p><p><code>cli/vex.json</code>:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;dependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;my-core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>If <code>my-core</code> is a member of the workspace and its <code>vex.json</code> declares <code>name: &quot;my-core&quot;</code>, Vex will ignore the registry and link directly to the <code>core/</code> directory.</p><h3 id="external-overrides-patching" tabindex="-1">External Overrides (Patching) <a class="header-anchor" href="#external-overrides-patching" aria-label="Permalink to “External Overrides (Patching)”">​</a></h3><p>You can override dependencies for the entire workspace using a <code>patch</code> section in <code>vex.workspace</code>. This is useful for testing against a local fork of an external library.</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;patch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;github.com/user/some-lib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;../local-forks/some-lib&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="build-artifacts" tabindex="-1">Build Artifacts <a class="header-anchor" href="#build-artifacts" aria-label="Permalink to “Build Artifacts”">​</a></h2><p>All packages in the workspace output their build artifacts to a single <code>vex-builds</code> directory at the workspace root.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>vex-builds/</span></span>
<span class="line"><span>├── debug/</span></span>
<span class="line"><span>│   ├── my-core.a</span></span>
<span class="line"><span>│   ├── my-net.a</span></span>
<span class="line"><span>│   └── my-cli      (executable)</span></span>
<span class="line"><span>└── release/</span></span>
<span class="line"><span>    └── ...</span></span></code></pre></div><p>This sharing allows:</p><ul><li><strong>Incremental Builds</strong>: If <code>core</code> is updated, <code>cli</code> only needs to relink, not recompile unchanged dependencies.</li><li><strong>Disk Space Efficiency</strong>: Shared dependencies are compiled once.</li></ul><hr><h2 id="cli-behavior" tabindex="-1">CLI Behavior <a class="header-anchor" href="#cli-behavior" aria-label="Permalink to “CLI Behavior”">​</a></h2><p>When running <code>vex</code> commands inside a workspace:</p><h3 id="vex-build" tabindex="-1"><code>vex build</code> <a class="header-anchor" href="#vex-build" aria-label="Permalink to “vex build”">​</a></h3><ul><li><strong>Root</strong>: Builds all packages defined in <code>default-members</code> (or all members if not specified).</li><li><strong>Subdirectory</strong>: If run inside <code>cli/</code>, builds only <code>my-cli</code> and its dependencies.</li><li><strong>Flags</strong>: <ul><li><code>--workspace</code>: Build all packages in the workspace.</li><li><code>--package &lt;name&gt;</code> / <code>-p &lt;name&gt;</code>: Build a specific package.</li><li><code>--exclude &lt;name&gt;</code>: Exclude a package from the build.</li></ul></li></ul><h3 id="vex-test" tabindex="-1"><code>vex test</code> <a class="header-anchor" href="#vex-test" aria-label="Permalink to “vex test”">​</a></h3><ul><li><strong>Root</strong>: Runs tests for all workspace members.</li><li><strong>Subdirectory</strong>: Runs tests for the current package.</li><li><strong>Flags</strong>: <ul><li><code>--workspace</code>: Test all packages.</li></ul></li></ul><h3 id="vex-run" tabindex="-1"><code>vex run</code> <a class="header-anchor" href="#vex-run" aria-label="Permalink to “vex run”">​</a></h3><ul><li>Must specify which binary to run if there are multiple.</li><li><code>vex run -p my-cli</code></li></ul><h3 id="vex-new" tabindex="-1"><code>vex new</code> <a class="header-anchor" href="#vex-new" aria-label="Permalink to “vex new”">​</a></h3><ul><li><code>vex new lib my-lib</code>: Creates a new package directory and adds it to <code>vex.workspace</code> members automatically if created inside a workspace root.</li></ul><hr><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to “Best Practices”">​</a></h2><ol><li><strong>Shared Configuration</strong>: Put common compiler flags and profiles in <code>vex.workspace</code> to ensure consistency.</li><li><strong>CI/CD</strong>: Run <code>vex test --workspace</code> in CI to ensure changes in one package don&#39;t break others.</li><li><strong>Versioning</strong>: While packages can have independent versions, it&#39;s often easier to keep workspace members versioned together (e.g., all at 1.0.0) if they are tightly coupled.</li></ol>`,59)])])}const g=s(t,[["render",l]]);export{k as __pageData,g as default};
